\chapter{Introduction}

\section{Motivation}
% are these words too informal?
Fluids can be seen everywhere. The smoke coming out of chimney spreading in the wind, the milk in a cup mixing with the coffee, the calm flow of a river with tiny ripples under the rain, and the enormous waves of the ocean splashing onto the surface. Many of these these phenomenons have interesting and even stunning visual effects, thus, quite often, plausible images of these fluids need to be computationally generated for purposes such as cinematics and video gaming. 

% Is the hours->seconds thing appropriate? 
Due to the complexity underlying the behavior of fluids, accurate numerical simulation of fluids often require a huge amount of computational resources. In areas such as aeronautic engineering, where the importance of accuracy completely overrides that of efficiency, hours of CPU time can be spent on the simulation of a few seconds of fluid motion. Real time computer graphics applications, such as video games, usually do not require this level of accuracy, but instead asks the simulation to be computed in roughly the same amount of time as the physical process it represents. This efficiency requirement is met with the help of modern GPUs, which have massively parallel computing abilities. This project demonstrates this by implementing three simulation algorithms on GPUs, all of which can perform simulations in real time.

For computer graphics applications, fluid simulation isn't the only task. It is equally necessary for the software to display the results of simulation (i.e, the shape and motion of the fluid) to the user. This is especially important for interactive video games, where the user experience highly depends on the quality of the rendering, maybe even more so than the accuracy of simulation. This project thus studies and implements the real time photorealistic rendering of a special, but likely most important, type of fluid: liquids. 




\section{Related Work}



The study of the behavior of fluids dates back to 18th century, when Leonhard Euler proposed a set of partial differential equations (PDEs), known as \textit{\ref{eqn:Euler Equations}}, that governs the behavior of an idealized incompressible and inviscid fluid. In the 19th century, these equations were extended by Claude-Louis Navier and George Gabriel Stokes into the famous \textit{\ref{eqn:Navier-Stokes Equations}}, which describe a much wider class of fluids that occur in the real world. These equations are exactly what most fluid simulation softwares, including the one implemented in this project, are trying to solve. 

Somewhat unfortunately, the Euler and Navier-Stokes equations have extremely difficult mathematical properties, and general analytical solutions are yet to be found even today. As a result, softwares resort to numerical methods to approximate solutions. In computer graphics applications, there are two main families of numerical methods for solving the fluid equations: the grid-based methods and the particle-based methods. Each approach comes with its own benefits and drawbacks, but could both be implemented efficiently on GPUs to achieve real time simulation.

The grid-based methods relies on spatial discretizations of the fields (e.g the velocity field) that represents the fluids. The most widely used discretization method, known as the \textbf{MAC} (Marker and Cell) \textbf{grid}, was proposed by Harlow and Welch \cite{harlow1965numerical} in 1965. This grid offers second order accuracy, and is used as a basis of most fluid simulation algorithms. 

A significantly important step during a grid-based simulation is to move all the physical quantities stored in the grid (e.g velocity, concentration) according to the velocity field. This step, known as \textbf{advection}, essentially determines how the fluid moves and thus how its shape changes, and is key to the quality of a simulation. A few popular advection algorithms include \textbf{MacCormack}\cite{selle2008unconditionally} and \textbf{BFECC}\cite{kim2005flowfixer}, both of which have efficient GPU implementations\cite{chentanez2011real}\cite{xu2011interactive}. The most widely used advection algorithm is known as \textbf{FLIP} (Fluid Implicit Particle)\cite{zhu2005animating}, developed by Zhu and Bridson. This algorithm, interestingly enough, makes uses of particles to move quantities within the MAC grid. FLIP has various advantages over the purely grid-based algorithms, and this project demonstrates how the original FLIP can be efficiently adapted to work on GPUs.

As an addition to the traditional single phase fluid simulation, Kang et el.\cite{kang2010hybrid} showed how to extend the grid-based algorithms to capture the diffusion between multiple fluid phases (e.g red ink diffusing in transparent water). This project implements a modified version of the proposed algorithm, where FLIP, rather than BFECC, is used to advect the concentration of different fluid phases.

Parallel to the grid-based approach is the family of particle-based algorithms. For computer graphics, the most commonly used class of particle-based algorithms is known as \textbf{SPH} (Smoothed Particle Hydrodynamics). Introduced to computer graphics in 2003 by Müller \cite{muller2003particle}, the SPH method represent the fluid by a moving cloud of particles, which carry the physical quantities with them. This project chooses to implement two extensions to SPH:  \textbf{PCISPH}(Predicative-Corrective Incompressible SPH) by Solenthalar\cite{solenthaler2009predictive} and \textbf{PBF}(Position Based Fluids) by Macklin and Müller\cite{macklin2013position}. These extended algorithms improve upon the plain SPH in that they enforce the incompressibility constraint of fluids, which are important for visual fidelity. 

Given a well performing simulation, either grid-based or particle-based, it remains a nontrivial task to visualize the fluid. This project follows the proposal by Zhu and Bridson \cite{zhu2005animating}, who showed how a particle representation of a fluid can be used to compute a signed distance field, which represents the distance to the fluid surface of each point in the 3D space. An algorithm known as Marching Cubes \cite{lorensen1987marching}, proposed by Lorensen, can then use this field to reconstruct the surface of the fluid into a triangle mesh representation, which is suitable for rendering. 



\section{Outline of Project and Report}


This project focuses on investigating and producing highly performant GPU implementations of the most widely used fluid simulation and rendering algorithms. An extended version of the FLIP algorithm, which supports multiple fluid simulation and diffusions between fluids of different colors, is studied and implemented, with the details elaborated in chapter \ref{chapter grid}. Similarly, GPU versions of the PCISPH and PBF algorithm are also created, as described in chapter \ref{chapter particle}. 

To visualize the simulations, the project implements a fast surface reconstruction algorithm, which transforms a particle cloud representation of fluids into a renderable triangle mesh. A real time renderer is implemented to render the mesh while capturing all the reflection and refraction phenomenons that occur in the real world. Furthermore, the renderer takes into account the different levels of attenuation of light caused by fluids of different colors, thereby also realistically rendering the liquid diffusion effects. The details of the renderer are given in chapter \ref{chapter render}.

These implementations are based from their origin descriptions in the papers, but many additional considerations and optimizations were taken to enable efficient parallelization. Specifically, the project utilizes NVIDIA's general purpose GPU programming interface known as CUDA, and tailors the implementation code to exploit the full potential of CUDA GPUs. The results are showcased by a fully functional program, which allows the user to easily configure the starting state of a simulation. These include the shapes and sizes of the fluid before the simulation starts, as well as the initial color and transparency of each fluid volume. The program can then carry out the simulation and render realistic results to the user in real time.